/*
Deployment script for DbFundamentals

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "DbFundamentals"
:setvar DefaultFilePrefix "DbFundamentals"
:setvar DefaultDataPath "D:\Sql\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "D:\Sql\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key b065725a-ce2c-4a09-adab-4425bb8c1ad7 is skipped, element [dbo].[AcquisitionType].[TypeCode] (SqlSimpleColumn) will not be renamed to Code';


GO
PRINT N'Rename refactoring operation with key 42862ddd-cba0-4935-83c0-dbadbdfb743d is skipped, element [dbo].[Hoc].[HocCode] (SqlSimpleColumn) will not be renamed to Code';


GO
PRINT N'Rename refactoring operation with key 1408833f-0af8-4115-95b0-100258922c6b is skipped, element [dbo].[MainStep].[StepCode] (SqlSimpleColumn) will not be renamed to Code';


GO
PRINT N'Creating [dbo].[AcquisitionType]...';


GO
CREATE TABLE [dbo].[AcquisitionType] (
    [AcquisitionTypeId] INT              IDENTITY (1, 1) NOT NULL,
    [Code]              NVARCHAR (40)    NOT NULL,
    [Name]              NVARCHAR (80)    NOT NULL,
    [Abbr]              NVARCHAR (8)     NULL,
    [FullName]          NVARCHAR (100)   NULL,
    [DisplayOrder]      INT              NOT NULL,
    [CreatedBy]         UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]         DATETIME         NOT NULL,
    [UpdatedBy]         UNIQUEIDENTIFIER NULL,
    [UpdatedOn]         DATETIME         NULL,
    [DeactivatedBy]     UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]     DATETIME         NULL,
    CONSTRAINT [PK_AcquisitionType] PRIMARY KEY CLUSTERED ([AcquisitionTypeId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_AcquisitionType__Name] UNIQUE NONCLUSTERED ([Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[AssignmentType]...';


GO
CREATE TABLE [dbo].[AssignmentType] (
    [AssignmentTypeId] INT              IDENTITY (1, 1) NOT NULL,
    [Name]             NVARCHAR (60)    NOT NULL,
    [Abbr]             NVARCHAR (8)     NOT NULL,
    [DisplayOrder]     INT              NOT NULL,
    [CreatedBy]        UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]        DATETIME         NOT NULL,
    [UpdatedBy]        UNIQUEIDENTIFIER NULL,
    [UpdatedOn]        DATETIME         NULL,
    [DeactivatedBy]    UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]    DATETIME         NULL,
    CONSTRAINT [PK_AssignmentType] PRIMARY KEY CLUSTERED ([AssignmentTypeId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_AssignmentType__AcAppId_Name] UNIQUE NONCLUSTERED ([Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[ContractArea]...';


GO
CREATE TABLE [dbo].[ContractArea] (
    [ContractAreaId] INT              IDENTITY (1, 1) NOT NULL,
    [Code]           NVARCHAR (40)    NULL,
    [Name]           NVARCHAR (40)    NOT NULL,
    [Abbr]           NVARCHAR (8)     NULL,
    [CreatedBy]      UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]      DATETIME         NOT NULL,
    [UpdatedBy]      UNIQUEIDENTIFIER NULL,
    [UpdatedOn]      DATETIME         NULL,
    [DeactivatedBy]  UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]  DATETIME         NULL,
    CONSTRAINT [PK_ContractArea] PRIMARY KEY CLUSTERED ([ContractAreaId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_ContractArea__Code_Name] UNIQUE NONCLUSTERED ([Code] ASC, [Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[ContractorType]...';


GO
CREATE TABLE [dbo].[ContractorType] (
    [ContractorTypeId] INT              IDENTITY (1, 1) NOT NULL,
    [Name]             NVARCHAR (80)    NOT NULL,
    [Abbr]             NVARCHAR (8)     NULL,
    [DisplayOrder]     INT              NOT NULL,
    [CreatedBy]        UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]        DATETIME         NOT NULL,
    [UpdatedBy]        UNIQUEIDENTIFIER NULL,
    [UpdatedOn]        DATETIME         NULL,
    [DeactivatedBy]    UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]    DATETIME         NULL,
    CONSTRAINT [PK_ContractorType] PRIMARY KEY CLUSTERED ([ContractorTypeId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_ContractorType__Name] UNIQUE NONCLUSTERED ([Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Hoc]...';


GO
CREATE TABLE [dbo].[Hoc] (
    [HocId]         INT              IDENTITY (1, 1) NOT NULL,
    [Code]          NVARCHAR (40)    NOT NULL,
    [Name]          NVARCHAR (40)    NOT NULL,
    [Abbr]          NVARCHAR (8)     NULL,
    [DisplayOrder]  INT              NOT NULL,
    [CreatedBy]     UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]     DATETIME         NOT NULL,
    [UpdatedBy]     UNIQUEIDENTIFIER NULL,
    [UpdatedOn]     DATETIME         NULL,
    [DeactivatedBy] UNIQUEIDENTIFIER NULL,
    [DeactivatedOn] DATETIME         NULL,
    CONSTRAINT [PK_Hoc] PRIMARY KEY CLUSTERED ([HocId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_Hoc__HocCode] UNIQUE NONCLUSTERED ([Code] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[MainStep]...';


GO
CREATE TABLE [dbo].[MainStep] (
    [MainStepId]    INT              IDENTITY (1, 1) NOT NULL,
    [Code]          NVARCHAR (40)    NOT NULL,
    [Name]          NVARCHAR (80)    NOT NULL,
    [Abbr]          NVARCHAR (8)     NULL,
    [FullName]      NVARCHAR (100)   NULL,
    [DisplayOrder]  INT              NOT NULL,
    [CreatedBy]     UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]     DATETIME         NOT NULL,
    [UpdatedBy]     UNIQUEIDENTIFIER NULL,
    [UpdatedOn]     DATETIME         NULL,
    [DeactivatedBy] UNIQUEIDENTIFIER NULL,
    [DeactivatedOn] DATETIME         NULL,
    CONSTRAINT [PK_MainStepId] PRIMARY KEY CLUSTERED ([MainStepId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_MainStep__Name] UNIQUE NONCLUSTERED ([Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[NspType]...';


GO
CREATE TABLE [dbo].[NspType] (
    [NspTypeId]     INT              IDENTITY (1, 1) NOT NULL,
    [Name]          NVARCHAR (40)    NOT NULL,
    [Abbr]          NVARCHAR (8)     NOT NULL,
    [DisplayOrder]  INT              NOT NULL,
    [CreatedBy]     UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]     DATETIME         NOT NULL,
    [UpdatedBy]     UNIQUEIDENTIFIER NULL,
    [UpdatedOn]     DATETIME         NULL,
    [DeactivatedBy] UNIQUEIDENTIFIER NULL,
    [DeactivatedOn] DATETIME         NULL,
    CONSTRAINT [PK_NspTypeId] PRIMARY KEY CLUSTERED ([NspTypeId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_NspType__Name] UNIQUE NONCLUSTERED ([Name] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Property]...';


GO
CREATE TABLE [dbo].[Property] (
    [PropertyId]           INT              IDENTITY (1, 1) NOT NULL,
    [MainStepId]           INT              NOT NULL,
    [AcquisitionTypeId]    INT              NULL,
    [ContractAreaId]       INT              NULL,
    [PropertyStatusId]     INT              NOT NULL,
    [PropertyTypeId]       INT              NOT NULL,
    [HocId]                INT              NULL,
    [NspTypeId]            INT              NULL,
    [CaseNumber]           NVARCHAR (60)    NOT NULL,
    [Address]              NVARCHAR (250)   NOT NULL,
    [Address2]             NVARCHAR (80)    NULL,
    [UnitNo]               NVARCHAR (36)    NULL,
    [City]                 NVARCHAR (60)    NULL,
    [County]               NVARCHAR (60)    NULL,
    [State]                NVARCHAR (60)    NULL,
    [ZipCode]              NVARCHAR (60)    NOT NULL,
    [StepOn]               DATETIME         NULL,
    [StatusOn]             DATETIME         NULL,
    [ReceivedOn]           DATETIME         NULL,
    [AcquisitionOn]        DATETIME         NULL,
    [EstimatedCloseOn]     DATETIME         NULL,
    [IsActive]             NCHAR (1)        NULL,
    [IsOccupied]           NCHAR (1)        NULL,
    [HomCode]              NVARCHAR (60)    NULL,
    [FeeStatusCode]        NVARCHAR (60)    NULL,
    [ContractType]         NVARCHAR (60)    NULL,
    [HasVandalism]         NCHAR (1)        NULL,
    [YearBuilt]            NVARCHAR (12)    NULL,
    [IsMobileHome]         NCHAR (1)        NULL,
    [Latitude]             FLOAT (53)       NULL,
    [Longitude]            FLOAT (53)       NULL,
    [Bedrooms]             INT              NULL,
    [Bathrooms]            FLOAT (53)       NULL,
    [Stories]              INT              NULL,
    [LotLength]            INT              NULL,
    [LotWidth]             INT              NULL,
    [ParcelNumber]         NVARCHAR (60)    NULL,
    [IsRevitalizationArea] NCHAR (1)        NULL,
    [IsAssetControlArea]   NCHAR (1)        NULL,
    [AssetControlAreaType] NVARCHAR (60)    NULL,
    [IsIndianLand]         NCHAR (1)        NULL,
    [CreatedBy]            UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]            DATETIME         NOT NULL,
    [UpdatedBy]            UNIQUEIDENTIFIER NULL,
    [UpdatedOn]            DATETIME         NULL,
    [DeactivatedBy]        UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]        DATETIME         NULL,
    CONSTRAINT [PK_Property] PRIMARY KEY CLUSTERED ([PropertyId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_Property__CaseNumber] UNIQUE NONCLUSTERED ([CaseNumber] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Property].[IX_Property_MainStepId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_MainStepId]
    ON [dbo].[Property]([MainStepId] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_AcquistionTypeId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_AcquistionTypeId]
    ON [dbo].[Property]([AcquisitionTypeId] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_ContractAreaId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_ContractAreaId]
    ON [dbo].[Property]([ContractAreaId] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_PropertyStatusId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_PropertyStatusId]
    ON [dbo].[Property]([PropertyStatusId] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_PropertyTypeId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_PropertyTypeId]
    ON [dbo].[Property]([PropertyTypeId] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_HocId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_HocId]
    ON [dbo].[Property]([HocId] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_NspTypeId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_NspTypeId]
    ON [dbo].[Property]([NspTypeId] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property__Address_City_State_ZipCode]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property__Address_City_State_ZipCode]
    ON [dbo].[Property]([Address] ASC, [City] ASC, [State] ASC, [ZipCode] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property__State_County_City]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property__State_County_City]
    ON [dbo].[Property]([State] ASC, [County] ASC, [City] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_StepOn]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_StepOn]
    ON [dbo].[Property]([StepOn] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_StatusOn]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_StatusOn]
    ON [dbo].[Property]([StatusOn] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_AcquisitionOn]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_AcquisitionOn]
    ON [dbo].[Property]([AcquisitionOn] ASC);


GO
PRINT N'Creating [dbo].[Property].[IX_Property_DeactivatedOn]...';


GO
CREATE NONCLUSTERED INDEX [IX_Property_DeactivatedOn]
    ON [dbo].[Property]([DeactivatedOn] ASC);


GO
PRINT N'Creating [dbo].[PropertyAssignment]...';


GO
CREATE TABLE [dbo].[PropertyAssignment] (
    [PropertyAssignmentId] INT              IDENTITY (1, 1) NOT NULL,
    [PropertyId]           INT              NOT NULL,
    [PropertyContractorId] INT              NOT NULL,
    [AssignmentTypeId]     INT              NOT NULL,
    [AssignedOn]           DATETIME2 (7)    NULL,
    [CreatedBy]            UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]            DATETIME         NOT NULL,
    [UpdatedBy]            UNIQUEIDENTIFIER NULL,
    [UpdatedOn]            DATETIME         NULL,
    [DeactivatedBy]        UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]        DATETIME         NULL,
    CONSTRAINT [PK_PropertyAssignment] PRIMARY KEY CLUSTERED ([PropertyAssignmentId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_PropertyAssignment__PropertyId__AssignmentTypeId] UNIQUE NONCLUSTERED ([PropertyId] ASC, [AssignmentTypeId] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[PropertyContractor]...';


GO
CREATE TABLE [dbo].[PropertyContractor] (
    [PropertyContractorId] INT              IDENTITY (1, 1) NOT NULL,
    [ContractorTypeId]     INT              NOT NULL,
    [NaId]                 NVARCHAR (40)    NOT NULL,
    [Name]                 NVARCHAR (80)    NOT NULL,
    [Address]              NVARCHAR (250)   NULL,
    [City]                 NVARCHAR (60)    NULL,
    [County]               NVARCHAR (60)    NULL,
    [State]                NVARCHAR (60)    NULL,
    [ZipCode]              NVARCHAR (60)    NULL,
    [OfficePhone]          NVARCHAR (24)    NULL,
    [OfficeExtension]      NVARCHAR (12)    NULL,
    [Fax]                  NVARCHAR (24)    NULL,
    [OfficeEmail]          NVARCHAR (100)   NULL,
    [CreatedBy]            UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]            DATETIME         NOT NULL,
    [UpdatedBy]            UNIQUEIDENTIFIER NULL,
    [UpdatedOn]            DATETIME         NULL,
    [DeactivatedBy]        UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]        DATETIME         NULL,
    CONSTRAINT [PK_PropertyContractor] PRIMARY KEY CLUSTERED ([PropertyContractorId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_PropertyContractor__NaId_Name] UNIQUE NONCLUSTERED ([NaId] ASC, [Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[PropertyContractor].[IX_PropertyContractor_ContractorTypeId]...';


GO
CREATE NONCLUSTERED INDEX [IX_PropertyContractor_ContractorTypeId]
    ON [dbo].[PropertyContractor]([ContractorTypeId] ASC);


GO
PRINT N'Creating [dbo].[PropertyStatus]...';


GO
CREATE TABLE [dbo].[PropertyStatus] (
    [PropertyStatusId] INT              IDENTITY (1, 1) NOT NULL,
    [Name]             NVARCHAR (60)    NOT NULL,
    [Abbr]             NVARCHAR (8)     NULL,
    [StatusCode]       NVARCHAR (24)    NOT NULL,
    [DisplayOrder]     INT              NOT NULL,
    [CreatedBy]        UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]        DATETIME         NOT NULL,
    [UpdatedBy]        UNIQUEIDENTIFIER NULL,
    [UpdatedOn]        DATETIME         NULL,
    [DeactivatedBy]    UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]    DATETIME         NULL,
    CONSTRAINT [PK_PropertyStatus] PRIMARY KEY CLUSTERED ([PropertyStatusId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_PropertyStatus__Name] UNIQUE NONCLUSTERED ([Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[PropertyType]...';


GO
CREATE TABLE [dbo].[PropertyType] (
    [PropertyTypeId] INT              IDENTITY (1, 1) NOT NULL,
    [Name]           NVARCHAR (60)    NOT NULL,
    [Abbr]           NVARCHAR (8)     NOT NULL,
    [DisplayOrder]   INT              NOT NULL,
    [CreatedBy]      UNIQUEIDENTIFIER NOT NULL,
    [CreatedOn]      DATETIME         NOT NULL,
    [UpdatedBy]      UNIQUEIDENTIFIER NULL,
    [UpdatedOn]      DATETIME         NULL,
    [DeactivatedBy]  UNIQUEIDENTIFIER NULL,
    [DeactivatedOn]  DATETIME         NULL,
    CONSTRAINT [PK_PropertyType] PRIMARY KEY CLUSTERED ([PropertyTypeId] ASC) ON [PRIMARY],
    CONSTRAINT [UQ_PropertyType__Name] UNIQUE NONCLUSTERED ([Name] ASC, [DeactivatedOn] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[FK_Property_MainStep]...';


GO
ALTER TABLE [dbo].[Property] WITH NOCHECK
    ADD CONSTRAINT [FK_Property_MainStep] FOREIGN KEY ([MainStepId]) REFERENCES [dbo].[MainStep] ([MainStepId]);


GO
PRINT N'Creating [dbo].[FK_Property_AcquisitionType]...';


GO
ALTER TABLE [dbo].[Property] WITH NOCHECK
    ADD CONSTRAINT [FK_Property_AcquisitionType] FOREIGN KEY ([AcquisitionTypeId]) REFERENCES [dbo].[AcquisitionType] ([AcquisitionTypeId]);


GO
PRINT N'Creating [dbo].[FK_Property_ContractArea]...';


GO
ALTER TABLE [dbo].[Property] WITH NOCHECK
    ADD CONSTRAINT [FK_Property_ContractArea] FOREIGN KEY ([ContractAreaId]) REFERENCES [dbo].[ContractArea] ([ContractAreaId]);


GO
PRINT N'Creating [dbo].[FK_Property_PropertyStatus]...';


GO
ALTER TABLE [dbo].[Property] WITH NOCHECK
    ADD CONSTRAINT [FK_Property_PropertyStatus] FOREIGN KEY ([PropertyStatusId]) REFERENCES [dbo].[PropertyStatus] ([PropertyStatusId]);


GO
PRINT N'Creating [dbo].[FK_Property_PropertyType]...';


GO
ALTER TABLE [dbo].[Property] WITH NOCHECK
    ADD CONSTRAINT [FK_Property_PropertyType] FOREIGN KEY ([PropertyTypeId]) REFERENCES [dbo].[PropertyType] ([PropertyTypeId]);


GO
PRINT N'Creating [dbo].[FK_Property_Hoc]...';


GO
ALTER TABLE [dbo].[Property] WITH NOCHECK
    ADD CONSTRAINT [FK_Property_Hoc] FOREIGN KEY ([HocId]) REFERENCES [dbo].[Hoc] ([HocId]);


GO
PRINT N'Creating [dbo].[FK_Property_NspType]...';


GO
ALTER TABLE [dbo].[Property] WITH NOCHECK
    ADD CONSTRAINT [FK_Property_NspType] FOREIGN KEY ([NspTypeId]) REFERENCES [dbo].[NspType] ([NspTypeId]);


GO
PRINT N'Creating [dbo].[FK_PropertyAssignment_Property]...';


GO
ALTER TABLE [dbo].[PropertyAssignment] WITH NOCHECK
    ADD CONSTRAINT [FK_PropertyAssignment_Property] FOREIGN KEY ([PropertyId]) REFERENCES [dbo].[Property] ([PropertyId]);


GO
PRINT N'Creating [dbo].[FK_PropertyAssignment_AssignmentType]...';


GO
ALTER TABLE [dbo].[PropertyAssignment] WITH NOCHECK
    ADD CONSTRAINT [FK_PropertyAssignment_AssignmentType] FOREIGN KEY ([AssignmentTypeId]) REFERENCES [dbo].[AssignmentType] ([AssignmentTypeId]);


GO
PRINT N'Creating [dbo].[FK_PropertyAssignment_PropertyContractor]...';


GO
ALTER TABLE [dbo].[PropertyAssignment] WITH NOCHECK
    ADD CONSTRAINT [FK_PropertyAssignment_PropertyContractor] FOREIGN KEY ([PropertyContractorId]) REFERENCES [dbo].[PropertyContractor] ([PropertyContractorId]);


GO
PRINT N'Creating [dbo].[FK_PropertyContractor_ContractorTypeId]...';


GO
ALTER TABLE [dbo].[PropertyContractor] WITH NOCHECK
    ADD CONSTRAINT [FK_PropertyContractor_ContractorTypeId] FOREIGN KEY ([ContractorTypeId]) REFERENCES [dbo].[ContractorType] ([ContractorTypeId]);


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'b065725a-ce2c-4a09-adab-4425bb8c1ad7')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('b065725a-ce2c-4a09-adab-4425bb8c1ad7')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '42862ddd-cba0-4935-83c0-dbadbdfb743d')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('42862ddd-cba0-4935-83c0-dbadbdfb743d')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '1408833f-0af8-4115-95b0-100258922c6b')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('1408833f-0af8-4115-95b0-100258922c6b')

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[Property] WITH CHECK CHECK CONSTRAINT [FK_Property_MainStep];

ALTER TABLE [dbo].[Property] WITH CHECK CHECK CONSTRAINT [FK_Property_AcquisitionType];

ALTER TABLE [dbo].[Property] WITH CHECK CHECK CONSTRAINT [FK_Property_ContractArea];

ALTER TABLE [dbo].[Property] WITH CHECK CHECK CONSTRAINT [FK_Property_PropertyStatus];

ALTER TABLE [dbo].[Property] WITH CHECK CHECK CONSTRAINT [FK_Property_PropertyType];

ALTER TABLE [dbo].[Property] WITH CHECK CHECK CONSTRAINT [FK_Property_Hoc];

ALTER TABLE [dbo].[Property] WITH CHECK CHECK CONSTRAINT [FK_Property_NspType];

ALTER TABLE [dbo].[PropertyAssignment] WITH CHECK CHECK CONSTRAINT [FK_PropertyAssignment_Property];

ALTER TABLE [dbo].[PropertyAssignment] WITH CHECK CHECK CONSTRAINT [FK_PropertyAssignment_AssignmentType];

ALTER TABLE [dbo].[PropertyAssignment] WITH CHECK CHECK CONSTRAINT [FK_PropertyAssignment_PropertyContractor];

ALTER TABLE [dbo].[PropertyContractor] WITH CHECK CHECK CONSTRAINT [FK_PropertyContractor_ContractorTypeId];


GO
PRINT N'Update complete.';


GO
